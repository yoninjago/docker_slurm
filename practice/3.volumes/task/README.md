## Stateful-приложения в Docker

Переходим в каталог `docker_course/practice/3.volumes/task`

### Самостоятельная работа

Эта самостоятельная работа позволит вам ещё раз попрактиковаться в составлении Dockerfile и docker-compose файлов, а также поработать с локальными томами (анонимными и именованными) и пробросом локальных каталогов в контейнер. Всё это позволит вам использовать ваши наработки в качестве среды для локальной разработки и отладки.

#### Внимание: если вам на данном этапе задание покажется слишком сложным, вернитесь к нему позднее.

Итак, у вас есть приложение на Flask, список зависимостей в файле requirements.txt и начальные данные для БД в каталоге `postgres/`.
Несмотря на то, что приложение само по себе очень простое, оно использует PostgreSQL в качестве базы данных и Redis для кэширования.
Рекомендации для запуска:
- Python 3.7
- команда для запуска - "flask run"
- порт 5000
- необходимые пакеты (для alpine): `postgresql-libs`, `.build-deps`, `gcc`, `musl-dev`, `postgresql-dev`
- проброс каталога с кодом (bind volume): в `/home/flask/app/`
- версия Redis 7.0
- версия PostgreSQL 15
- файл `postgres/init.sql` нужно пробросить в `/docker-entrypoint-initdb.d/init.sql` (если используется официальный образ)
- для БД нужно создать именованный том c именем `slurm_data` и смонтировать его в контейнер по пути `/var/lib/postgresql/data`
- проверить, что приложение запущено, можно так: `curl 127.0.0.1:5000`
Должен выдаваться ответ "Hello Slurm!  This page has been viewed 1 time(s)." и счетчик должен нарастать после каждого запроса к приложению.

Вам нужно самостоятельно написать Dockerfile для приложения и docker-compose.yml файл для сборки всего проекта.

#### Если не уверены, что всё сделано правильно

Для проверки можно запустить скрипт `./check_me.sh`. Если вы сделали всё правильно и точно следовали инструкции, скрипт покажет, на каком пункте у вас проблема.

#### Вопросы для размышления

* Посмотрите на список томов. Можете ли вы определить, какой из них какому приложению принадлежит?

* Что будет с томами и данными в них, если остановить проект (docker-compose down)? А если пересобрать приложение полностью?

* Как проще всего очистить старый том с данными, но оставить копию на всякий случай?

#### Если совсем зашли в тупик

Ответ (один из его возможных вариантов) можно найти в этом же каталоге с кодом для задания - в папке `_answer`.
