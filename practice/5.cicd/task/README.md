## Docker и CI/CD

Переходим в каталог `docker_course/practice/6.cicd/task`

### Самостоятельная работа

В этом задании вы сможете попробовать самостоятельно изменить получившийся у вас пайплайн, дополнив его redis для кэширования, то есть ещё одним контейнером. А самое интересное будет дальше, вам потребуется переписать логику деплоя приложения с простого Docker на Docker Compose, что приблизит вас к пониманию работы несложных приложений в продакшене.

#### Суть задания

Вам нужно добавить в форк xpaste ещё один контейнер (пусть будет redis) и переделать весь ваш пайплайн под docker-compose, а именно шаги build, push, deploy.

Рекомендации для успешного выполнения:
- версия API 3.9
- docker-compose 1.29.2
- для подключения к уже созданной сети используйте сеть с названием default, плюс пару параметров отсюда: https://docs.docker.com/compose/networking/#use-a-pre-existing-network
Проще говоря, вот такую конструкцию:
```yaml
services:
  # ...
networks:
  default:
    external: true
    name: my-pre-existing-network
```
- в публичном образе docker/compose нет SSH-клиента, установите его сами командой `apk --update add openssh-client` (если образ на базе alpine)
- для управления удаленным хостом при помощи docker-compose нужно запускать его с параметром -H: `docker-compose -H "ssh://username@host" ...`

#### Если не уверены, что всё сделано правильно

В первую очередь у вас все шаги пайпланы должны быть "зелеными", то есть завершаться успешно.
Также для проверки можно запустить скрипт `./check_me.sh`. Если вы сделали всё правильно и точно следовали инструкции, скрипт покажет, на каком пункте у вас проблема.

#### Вопросы для размышления

* Посмотрите на переменные окружения в файле `docker-compose.yml` (либо в прежнем варианте пайплайна - в файле `.gitlab-ci.yml`). Какие из них являются секретами и вы бы хотели их спрятать от посторонних глаз? Какие варианты решения проблемы у вас есть?

* Мы разворачивали приложение пока только в одно окружение. Подумайте, как бы вы модифицировали пайплайн для поддержки двух окружений (например, staging и production).

#### Если совсем зашли в тупик

Ответ (один из его возможных вариантов) можно найти в этом же каталоге с кодом для задания - в папке `_answer`.

#### Для перфекционистов

Можете дописать приложение на Ruby (xpaste), чтобы оно использовало redis в своей работе :)
